<idea-plugin>
    <id>org.finos.calm.intellij</id>
    <name>CALM Preview &amp; Tools</name>
    <vendor email="calm@finos.org" url="https://github.com/finos/architecture-as-code">FINOS</vendor>

    <description><![CDATA[
    Live-visualize CALM (Common Architecture Language Model) architecture models while you edit them.
    See structure, navigate quickly, validate, and explore your architecture models - all within IntelliJ IDEA.

    Features:
    - Interactive CALM Preview with graph visualization
    - Model Elements tree view (Nodes, Relationships, Flows)
    - File watching and auto-refresh on save
    - Navigation between graph and source code
    - Support for JSON and YAML CALM models
    - Configurable graph layouts and display options
    ]]></description>

    <!-- Product and plugin compatibility requirements -->
    <depends>com.intellij.modules.platform</depends>
    <depends>com.intellij.modules.lang</depends>

    <extensions defaultExtensionNs="com.intellij">
        <!-- Tool Window -->
        <toolWindow id="CALM" secondary="true" icon="/icons/calm.svg" anchor="right"
                    factoryClass="org.finos.calm.intellij.toolwindow.CalmToolWindowFactory"/>

        <!-- File Type -->
        <fileType name="CALM JSON" implementationClass="org.finos.calm.intellij.filetype.CalmJsonFileType"
                  fieldName="INSTANCE" language="JSON" extensions="json"/>
        <fileType name="CALM YAML" implementationClass="org.finos.calm.intellij.filetype.CalmYamlFileType"
                  fieldName="INSTANCE" language="yaml" extensions="yaml;yml"/>

        <!-- Settings -->
        <applicationConfigurable parentId="tools" instance="org.finos.calm.intellij.settings.CalmSettingsConfigurable"
                                 id="org.finos.calm.intellij.settings" displayName="CALM"/>

        <!-- File Editor Provider -->
        <fileEditorProvider implementation="org.finos.calm.intellij.editor.CalmPreviewEditorProvider"/>

        <!-- Project Service -->
        <projectService serviceImplementation="org.finos.calm.intellij.services.CalmModelService"/>
    </extensions>

    <actions>
        <!-- Add your actions here -->
        <action id="org.finos.calm.intellij.OpenPreview" class="org.finos.calm.intellij.actions.OpenPreviewAction"
                text="Open CALM Preview" description="Open CALM Preview for the current file">
            <add-to-group group-id="EditorTabPopupMenu" anchor="after" relative-to-action="CloseEditor"/>
            <keyboard-shortcut keymap="$default" first-keystroke="ctrl shift C"/>
        </action>
    </actions>

    <projectListeners>
        <listener class="org.finos.calm.intellij.listeners.CalmFileListener"
                  topic="com.intellij.openapi.vfs.VirtualFileListener"/>
    </projectListeners>
</idea-plugin>